(this["webpackJsonprns-rskdomains-batch-client"]=this["webpackJsonprns-rskdomains-batch-client"]||[]).push([[0],{184:function(e,t,n){e.exports=n(414)},204:function(e,t){},227:function(e,t){},229:function(e,t){},296:function(e,t){},414:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(46),i=n.n(l),o=n(13),c=n(59),s=n(23),u=n(96),m=Object(o.c)()((function(){return r.a.createElement("nav",{className:"navbar navbar-expand-md navbar-light bg-light fixed-top"},r.a.createElement("div",{className:"container"},r.a.createElement(u.a,{className:"navbar-brand",to:"/"},r.a.createElement("img",{src:"assets/img/logo.svg",className:"logo",alt:"logo"})),r.a.createElement("h3",null,".rsk domains batch"),r.a.createElement("small",null,"RSK Testnet")))})),d=n(416),f=n(417),h=function(){return r.a.createElement("footer",null,r.a.createElement("div",{className:"footer-top"},r.a.createElement(d.a,null,r.a.createElement(f.a,null,r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("img",{src:"assets/img/powered_by_iov.svg",className:"img-fluid powered_by",alt:"powered_by"})),r.a.createElement("div",{className:"col-lg-4"},r.a.createElement("span",{className:"footer-title mb-3"},"What is RNS?"),r.a.createElement("p",{className:"mb-5"},"RIF Name Service provides an architecture which enables the identification of blockchain addresses by human-readable names.")),r.a.createElement("div",{className:"col-lg-3"}),r.a.createElement("div",{className:"col-lg-3"}),r.a.createElement("div",{className:"col-lg-2"},r.a.createElement("a",{href:"https://gitter.im/rsksmart/rif-name-service",target:"_blank",rel:"noopener noreferrer"},"Gitter"),r.a.createElement("a",{href:"https://rsksamrt.github.io/rif.rns/tools/subdomain-batch",target:"_blank",rel:"noopener noreferrer"},"Docs"),r.a.createElement("a",{href:"https://github.com/rnsdomains/rns-subdomain-batch",target:"_blank",rel:"noopener noreferrer"},"Issues"))))))},p=n(178),b=n(17),E=n.n(b),v=n(33),g=n(26),y=n(27),C=n(29),w=n(28),O=n(11),k=n(30),j=n(41),S=n(420),A=n(418),N=n(101),R=n.n(N),x=n(42),I=n.n(x),T=new I.a("https://public-node.testnet.rsk.co"),F=new T.eth.Contract([{constant:!0,inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"available",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"}],"0xca0a477e19bac7e0e172ccfd2e3c28a7200bdb71");function P(){return(P=Object(j.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F.methods.available(T.utils.sha3(t)).call());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L={error:null,validating:!1,unconfirmedLabels:null,confirmed:0},D=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(C.a)(this,Object(w.a)(t).call(this,e))).state=L,n.handleUploadFile=n.handleUploadFile.bind(Object(O.a)(n)),n.error=n.error.bind(Object(O.a)(n)),n.confirm=n.confirm.bind(Object(O.a)(n)),n}return Object(k.a)(t,e),Object(y.a)(t,[{key:"handleUploadFile",value:function(e){var t=this;this.setState(Object(v.a)({},L,{validating:!0}));for(var n=[],a=0;a<e.length;a+=1)n.push(e[a][0]);for(var r=0;r<n.length;r+=1){var l=n[r];if(!l.length>=5||!l.match(/^[0-9a-z]+$/))return this.error("Invalid domain: ".concat(l))}for(var i=[],o=function(e){i.push(function(e){return P.apply(this,arguments)}(n[e]).then((function(a){a||t.error("Domain not available: ".concat(n[e],". Please remove it from the list."))})))},c=0;c<n.length;c+=1)o(c);Promise.all(i).then((function(){t.setState({validating:!1,unconfirmedLabels:n})}))}},{key:"error",value:function(e){this.setState({error:e})}},{key:"confirm",value:function(){var e=this.state.unconfirmedLabels,t=this.props.labelsAvailable;this.setState({confirmed:e.length}),t(e)}},{key:"render",value:function(){var e,t=this.state,n=t.error,a=t.validating,l=t.unconfirmedLabels,i=t.confirmed;if(n)e=r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{variant:"danger"},n),r.a.createElement(R.a,{onFileLoaded:this.handleUploadFile}));else if(0!==i||a||l)if(0===i&&a&&!l)e=r.a.createElement("p",null,"Labels are valid, checking availability...");else if(0===i&&!a&&l)e=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Labels are valid and available!"),r.a.createElement("ul",null,l.map((function(e,t){return r.a.createElement("li",{key:t},e)}))),r.a.createElement(A.a,{onClick:this.confirm},"Confirm"));else{if(!l||0===i)throw new Error("Unhandled state.");e=r.a.createElement("p",null,"Confirmed domains to register: ",i)}else e=r.a.createElement(R.a,{onFileLoaded:this.handleUploadFile});return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Upload ",r.a.createElement("code",null,"csv")," file with one column containing the labels to register. Ensure not to use .rsk at the end, lower cases, and no spaces."),e)}}]),t}(a.Component),_=Object(o.c)((function(e){return{labels:e.app.labels}}),(function(e){return{labelsAvailable:function(t){return e(function(e){return{type:"LABELS_AVAILABLE",labels:e}}(t))}}}))(D),B=n(419),M=new I.a("https://public-node.testnet.rsk.co"),U=new M.eth.Contract([{constant:!0,inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"uint256",name:"expires",type:"uint256"},{internalType:"uint256",name:"duration",type:"uint256"}],name:"price",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],"0x36ffda909f941950a552011f2c50569fda14a169");function W(){return(W=Object(j.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",U.methods.price("",0,t).call());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(C.a)(this,Object(w.a)(t).call(this,e))).state={durationInput:1,duration:0,price:null,costOfOne:null,totalRif:null},n.handleDurationChange=n.handleDurationChange.bind(Object(O.a)(n)),n.setDuration=n.setDuration.bind(Object(O.a)(n)),n.confirm=n.confirm.bind(Object(O.a)(n)),n}return Object(k.a)(t,e),Object(y.a)(t,[{key:"handleDurationChange",value:function(e){this.setState({durationInput:e.target.value})}},{key:"setDuration",value:function(e){var t=this;e.preventDefault();var n=Number(this.state.durationInput);this.setState({duration:n});var a=this.props.labels;(function(e){return W.apply(this,arguments)})(n).then((function(e){var n=M.utils.toBN("1000000000000000000"),r=M.utils.toBN(e),l=r.mul(M.utils.toBN(a.length)).div(n),i=M.utils.toBN("60000000"),o=M.utils.toBN("6800000"),c=M.utils.toBN(Math.ceil(a.length/250)),s=M.utils.toBN(Math.ceil(a.length/35)),u=M.utils.toBN(i.mul(o).mul(c.add(s)));t.setState({costOfOne:e,price:{rif:l,rbtc:u},totalRif:r})}))}},{key:"confirm",value:function(){var e=this.props.confirmPrice,t=this.state,n=t.duration,a=t.costOfOne,r=t.totalRif;e(M.utils.toBN(n),M.utils.toBN(a),r)}},{key:"render",value:function(){var e=this.props,t=e.labels,n=e.confirmedPrice,a=this.state,l=a.duration,i=a.durationInput,o=a.price;if(!t)return null;if(0===l)return r.a.createElement(B.a,{onSubmit:this.setDuration},r.a.createElement(B.a.Group,null,r.a.createElement(B.a.Label,null,"For how long do you want to register the domains?"),r.a.createElement(B.a.Control,{onChange:this.handleDurationChange,value:i,type:"number",min:1}),r.a.createElement(A.a,{type:"submit"},"Confirm")));if(l>0&&!o)return r.a.createElement("p",null,"Calculating price...");if(l>0&&o)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Price: ",o.rif.toString()," RIF Tokens + ~",o.rbtc.toString()," RBTC (wei)"),!n&&r.a.createElement(A.a,{onClick:this.confirm},"Confirm"));throw new Error("Unhandled state.")}}]),t}(a.Component),z=Object(o.c)((function(e){var t=e.app;return{labels:t.labels,confirmedPrice:t.confirmedPrice}}),(function(e){return{confirmPrice:function(t,n,a){return e(function(e,t,n){return{type:"CONFIRM_PRICE",duration:e,cost:t,totalRif:n}}(t,n,a))}}}))(H),G=n(179),V=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(C.a)(this,Object(w.a)(t).call(this,e))).state={address:"",error:null},n.handleChangeAddress=n.handleChangeAddress.bind(Object(O.a)(n)),n.confirm=n.confirm.bind(Object(O.a)(n)),n}return Object(k.a)(t,e),Object(y.a)(t,[{key:"handleChangeAddress",value:function(e){var t=e.target.value;Object(G.isValidChecksumAddress)(t,"31")?this.setState({address:t,error:null}):this.setState({error:"Invalid address"})}},{key:"confirm",value:function(e){e.preventDefault(),(0,this.props.confirmAddress)(this.state.address)}},{key:"render",value:function(){var e=this.props,t=e.labels,n=e.confirmedPrice,a=e.ownerAddress,l=this.state,i=l.address,o=l.error;return t&&n?a?r.a.createElement("p",null,"Owner address: ",a):r.a.createElement(B.a,{onSubmit:this.confirm},r.a.createElement(B.a.Group,null,r.a.createElement(B.a.Label,null,"Address to own the domains"),r.a.createElement(B.a.Control,{type:"text",onChange:this.handleChangeAddress}),o&&r.a.createElement(B.a.Label,{style:{color:"red"}},o),r.a.createElement(A.a,{type:"submit",disabled:!i||o},"Confirm"))):null}}]),t}(a.Component),$=Object(o.c)((function(e){var t=e.app;return{labels:t.labels,confirmedPrice:t.confirmedPrice,ownerAddress:t.ownerAddress}}),(function(e){return{confirmAddress:function(t){return e({type:"CONFIRM_ADDRESS",ownerAddress:t})}}}))(V),J=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(C.a)(this,Object(w.a)(t).call(this,e))).state={tx:null,confirmed:!1},n.commit=n.commit.bind(Object(O.a)(n)),n}return Object(k.a)(t,e),Object(y.a)(t,[{key:"commit",value:function(){var e=this,t=this.props,n=t.method,a=t.success,r=t.sender;n.send({from:r}).on("transactionHash",(function(t){e.setState({tx:t})})).on("receipt",(function(t){e.setState({confirmed:!0}),a()}))}},{key:"render",value:function(){var e=this.props,t=e.from,n=e.to,a=this.state,l=a.tx,i=a.confirmed;return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("label",null,"From ",t," to ",n)),r.a.createElement(p.a,null,r.a.createElement(A.a,{onClick:this.commit,disabled:!!l},"Sign"))),l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("a",{href:"".concat("https://explorer.testnet.rsk.co/tx/").concat(l),target:"_blank",rel:"noopener noreferrer"},l))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,i?r.a.createElement("p",null,"Confirmed!"):r.a.createElement("p",null,"Waiting for confirmations...")))))}}]),t}(a.Component),Y=n(71),K=new I.a("https://public-node.testnet.rsk.co"),q=new K.eth.Contract([{constant:!0,inputs:[{internalType:"bytes32",name:"label",type:"bytes32"},{internalType:"address",name:"nameOwner",type:"address"},{internalType:"bytes32",name:"secret",type:"bytes32"}],name:"makeCommitment",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!0,inputs:[{internalType:"bytes32",name:"commitment",type:"bytes32"}],name:"canReveal",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"}],"0x36ffda909f941950a552011f2c50569fda14a169");function Q(){return(Q=Object(j.a)(E.a.mark((function e(t,n,a){var r,l;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],l=0;l<t.length;l+=1)r.push(q.methods.makeCommitment(K.utils.sha3(t[l]),n,a[l]).call());return e.abrupt("return",Promise.all(r));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t){for(var n=[],a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n}function Z(e,t,n,a){if(e.length!==n.length)throw new Error("Invalid amount of secrets");for(var r=0;r<e.length;r+=1)if(!e[r].length>0||!e[r].match(/^[0-9a-z]+$/))throw new Error("Invalid label: ".concat(e[r]));if(!K.utils.isAddress(t))throw new Error("Invalid owner");for(var l=0;l<n.length;l+=1)if(!K.utils.isHexStrict(n[l])||66!==n[l].length)throw new Error("Invalid secret: ".concat(n[l]));if(!K.utils.isBN(a))throw new Error("Invalid duration")}function ee(){return(ee=Object(j.a)(E.a.mark((function e(t){var n,a,r,l,i,o,c=arguments;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=c.length>1&&void 0!==c[1]?c[1]:5e3,a=c.length>2&&void 0!==c[2]?c[2]:12e4,r=[],l=Number(new Date)+a,i=0;i<t.length;i+=1)r.push(t[i][t[i].length-1]);return o=function e(t,a){for(var i=[],o=0;o<r.length;o+=1)i.push(q.methods.canReveal(r[o]).call());Promise.all(i).then((function(r){r.every((function(e){return e}))?t(r):Number(new Date)<l?setTimeout(e,n,t,a):a(new Error("Polling timeout"))}))},e.abrupt("return",new Promise(o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t,n,a){var r=t.toLowerCase().slice(2),l=n.slice(2),i=K.utils.padLeft(K.utils.numberToHex(a).slice(2),64,"0"),o=K.utils.asciiToHex(e).slice(2);return"".concat("0xc2c414c8").concat(r).concat(l).concat(i).concat(o)}function ne(e,t,n,a,r){for(var l=[],i=0;i<e.length;i+=1)l.push(te(e[i],t,n[i],a));return{size:e.length,data:"0x".concat(Y.encode([r,l]).toString("hex"))}}var ae=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(C.a)(this,Object(w.a)(t).call(this,e))).state={makingCommitments:!1,chunkedCommitments:null,chunkedDatas:null,from:null,canReveal:!1,batch:null,rif:null},n.createCommitments=n.createCommitments.bind(Object(O.a)(n)),n.enableWallet=n.enableWallet.bind(Object(O.a)(n)),n}return Object(k.a)(t,e),Object(y.a)(t,[{key:"createCommitments",value:function(){var e=this,t=this.props,n=t.labels,a=t.ownerAddress,r=t.duration,l=t.ready,i=t.cost;if(n){for(var o=function(e){for(var t=[],n=0;n<e;n+=1)t.push(K.utils.randomHex(32));return t}(n.length),c=X(n,35),s=X(o,35),u=[],m=0;m<c.length;m+=1)Z(c[m],a.toLowerCase(),s[m],r),u.push(ne(c[m],a.toLowerCase(),s[m],r,i));this.setState({chunkedDatas:u}),function(e,t,n){return Q.apply(this,arguments)}(n,a.toLowerCase(),o).then((function(t){var n=X(t,250);l(n.length,u.length),e.setState({chunkedCommitments:n})}))}}},{key:"enableWallet",value:function(){var e=this;window.ethereum.enable().then((function(t){return e.setState({from:t[0]})}));var t=new I.a(window.web3),n=new t.eth.Contract([{constant:!1,inputs:[{internalType:"bytes32[]",name:"commitments",type:"bytes32[]"}],name:"batchCommit",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],"0x380a47e2a1cec8a21cf00374ea5d092166a702fc"),a=new t.eth.Contract([{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"},{name:"_data",type:"bytes"}],name:"transferAndCall",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"}],"0x19f64674d8a5b4e652319f5e239efd3bc969a1fe");this.setState({batch:n,rif:a})}},{key:"shouldComponentUpdate",value:function(e,t){var n=this,a=e.missingCommitmentConfirmations,r=t.canReveal;0!==a||r||function(e){return ee.apply(this,arguments)}(this.state.chunkedCommitments).then((function(){return n.setState({canReveal:!0})}));return!0}},{key:"render",value:function(){var e=this.props,t=e.labels,n=e.confirmedPrice,a=e.ownerAddress,l=e.missingCommitmentConfirmations,i=e.missingRegisterConfirmations,o=e.commitmentSuccess,c=e.registerSuccess,s=e.cost,u=this.state,m=u.chunkedCommitments,f=u.chunkedDatas,h=u.from,p=u.canReveal,b=u.batch,E=u.rif;if(!t||!n||!a)return null;if(m&&f){if(h){if(h&&m)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Wallet address: ",h),r.a.createElement(d.a,null,m.map((function(e,n){return r.a.createElement(J,{key:n,from:250*n+1,to:250*(n+1)>=t.length?t.length:250*(n+1),sender:h,method:b.methods.batchCommit(e),success:o})}))),0===l&&!p&&r.a.createElement("p",null,"Polling until committed... this can take more than a minute."),0===l&&p&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Ready! Time to register!"),r.a.createElement(d.a,null,f.map((function(e,n){return r.a.createElement(J,{key:n,from:35*n+1,to:35*(n+1)>=t.length?t.length:35*(n+1),sender:h,method:E.methods.transferAndCall("0x380a47e2a1cec8a21cf00374ea5d092166a702fc",s.mul(K.utils.toBN(e.size)),e.data),success:c})})))),0===i&&r.a.createElement(S.a,{variant:"success"},"Success! Thanks for registering."));throw new Error("Unhandled state.")}return r.a.createElement(A.a,{onClick:this.enableWallet},"Enable wallet")}return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Prepare transactions transactions"),r.a.createElement(A.a,{onClick:this.createCommitments},"Prepare"))}}]),t}(a.Component),re=Object(o.c)((function(e){var t=e.app;return{labels:t.labels,confirmedPrice:t.confirmedPrice,duration:t.duration,cost:t.cost,ownerAddress:t.ownerAddress,missingCommitmentConfirmations:t.missingCommitmentConfirmations,missingRegisterConfirmations:t.missingRegisterConfirmations}}),(function(e){return{ready:function(t,n){return e(function(e,t){return{type:"READY",commitmentAmount:e,registerAmount:t}}(t,n))},commitmentSuccess:function(){return e({type:"SUCCESS_COMMITMENT"})},registerSuccess:function(){return e({type:"SUCCES_REGISTER"})}}}))(ae),le=function(){return r.a.createElement(d.a,{style:{textAlign:"center"}},r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("h3",null,"Choose domains"),r.a.createElement(_,null))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("hr",null))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("h3",null,"Calculate price"),r.a.createElement(z,null))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("hr",null))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("h3",null,"Choose owner"),r.a.createElement($,null))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("hr",null))),r.a.createElement(f.a,null,r.a.createElement(p.a,null,r.a.createElement("h3",null,"Execute registration"),r.a.createElement(re,null))))},ie=Object(o.c)()((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(m,null),r.a.createElement(s.c,null,r.a.createElement(s.a,{exact:!0,path:"/",render:function(){return r.a.createElement(le,null)}})),r.a.createElement(h,null))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var oe=n(19),ce=n(32),se=n(173),ue=n(180),me=(n(413),{labels:null,confirmedPrice:!1,duration:0,cost:null,totalRif:null,ownerAddress:null,missingCommitmentConfirmations:-1,missingRegisterConfirmations:-1}),de=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LABELS_AVAILABLE":return Object(v.a)({},e,{labels:t.labels});case"CONFIRM_PRICE":return Object(v.a)({},e,{confirmedPrice:!0,duration:t.duration,cost:t.cost,totalRif:t.totalRif});case"CONFIRM_ADDRESS":return Object(v.a)({},e,{ownerAddress:t.ownerAddress});case"READY":return Object(v.a)({},e,{missingCommitmentConfirmations:t.commitmentAmount,missingRegisterConfirmations:t.registerAmount});case"SUCCESS_COMMITMENT":return Object(v.a)({},e,{missingCommitmentConfirmations:e.missingCommitmentConfirmations-1});default:return e}},fe=Object(oe.a)(),he=[ue.a,Object(se.a)(fe)];var pe=function(e){var t;return Object(ce.e)((t=fe,Object(ce.c)({router:Object(c.b)(t),app:de})),e,Object(ce.d)(ce.a.apply(void 0,he)))}();i.a.render(r.a.createElement(o.a,{store:pe},r.a.createElement(c.a,{history:fe},r.a.createElement(ie,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[184,1,2]]]);
//# sourceMappingURL=main.03b1f99f.chunk.js.map